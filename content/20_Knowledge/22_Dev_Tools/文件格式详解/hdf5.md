---
publish: true
---


这对 fMRI 和深度学习研究来说是两个最基础的文件格式。对于从 EEG 转行做 fMRI 解码的你来说，理解它们的区别能帮你避开很多**内存爆炸**和**坐标对齐**的坑。

简单来说：
*   **`.nii.gz` (NIfTI)** 是给**医生和传统软件**看的，它懂**“解剖学”**（知道哪边是头，哪边是脚）。
*   **`.hdf5` (HDF5)** 是给**程序员和神经网络**看的，它懂**“效率”**（能从 1TB 数据里秒读 1kb）。

---

**全称：** Hierarchical Data Format version 5
**地位：** 科学计算和深度学习领域的**“集装箱”**。

#### 特点：
1.  **像“文件系统”一样：**
    一个 `.hdf5` 文件内部可以包含文件夹（Groups）和文件（Datasets）。你可以在一个文件里存图像、标签、元数据、甚至说明书。
2.  **支持“懒加载” (Lazy Loading) —— ⭐ 核心优势：**
    这是 NSD 推荐用 HDF5 的原因。
    假设有一个 500GB 的 HDF5 文件。当你打开它时，**Python 不会把它读进 RAM**，只是建立了一个链接。
    *   只有当你执行 `data[0:100]` 时，它才会精准地从硬盘读取那 100 个数。
    *   **这对深度学习训练至关重要**（你可以随机读取任意一个 Batch，而不需要把整个数据集加载到内存）。
3.  **无解剖信息：**
    它默认只是存纯数值矩阵。它不知道这是大脑。除非人为地把 affine matrix 存成属性（Attribute）。

#### 缺点：
*   **可视化不便：** 你没法直接用医学软件打开它看脑图。必须写代码把它转回 `.nii` 才能看。

#### 🐍 Python 读取方式 (使用 `h5py` 库)
```python
import h5py

# 打开文件 (秒开，不占内存)
f = h5py.File('data.hdf5', 'r')

# 查看内部结构 (像看字典一样)
print(f.keys()) # 可能输出 ['betas', 'labels', 'metadata']

# 获取数据对象 (依然没读进内存)
dataset = f['betas']

# 读取切片 (只读这部分进内存，速度极快)
# 假设 NSD 数据是 (X, Y, Z, Trials)
one_trial = dataset[:, :, :, 0] 
```

---

### 3. 总结与应用场景：BCI 研究生该怎么选？

在做脑信号解码研究时，通常遵循**“训练用 H5，看图用 NII”**的原则。

| 维度 | .nii.gz | .hdf5 |
| :--- | :--- | :--- |
| **比喻** | **纸质地图** (有经纬度，结构固定) | **智能仓库** (存取极快，结构灵活) |
| **主要用途** | **可视化**、检查 ROI 位置、与其他医学软件交互 | **模型训练 (DataLoader)**、存储处理好的特征矩阵 |
| **读取速度** | 慢 (需解压) | **极快** (支持随机切片) |
| **空间信息** | 自带 Affine 矩阵 | 通常不带 (纯数组) |
| **你的 NSD 策略** | 用来看 ROI 掩膜长什么样，或者检查预处理结果对不对。 | **用来做 PyTorch 的 Dataset**。训练时从这里读数据。 |
